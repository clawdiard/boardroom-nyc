---
interface Props {
  name: string;
  price: string;
  image?: string;
  brand?: string;
  category?: string;
  href?: string;
  soldOut?: boolean;
  reserved?: boolean;
  productId?: string;
  shopSlug?: string;
  shopName?: string;
  numericPrice?: number;
  weight?: number;
}

const { name, price, image, brand, category, href, soldOut = false, reserved = false, productId, shopSlug, shopName, numericPrice, weight = 500 } = Astro.props;
const base = import.meta.env.BASE_URL;
const canReserve = !soldOut && !reserved && productId && shopSlug;
const canBuy = !soldOut && productId && shopSlug && numericPrice;
const reserveHref = canReserve ? `${base}reserve/?product=${productId}&shop=${shopSlug}` : undefined;
const snipcartUrl = `${Astro.site || 'https://clawdiard.github.io/boardroom-nyc/'}products/`;
const itemUrl = `${snipcartUrl}`;
const transactionFee = canBuy ? (numericPrice * 0.08).toFixed(2) : '0';
---

<a class:list={['product-card', { 'product-card--sold-out': soldOut, 'product-card--reserved': reserved }]} href={href || '#'}>
  <div class="product-card__image">
    {image ? (
      <img src={image} alt={name} loading="lazy" />
    ) : (
      <div class="product-card__placeholder">ðŸ“¦</div>
    )}
    {soldOut && <span class="product-card__badge">Sold Out</span>}
    {reserved && <span class="product-card__badge product-card__badge--reserved">Reserved</span>}
  </div>
  <div class="product-card__body">
    {brand && <span class="product-card__brand">{brand}</span>}
    <h4 class="product-card__name">{name}</h4>
    <span class="product-card__price">{price}</span>
    {category && <span class="product-card__cat">{category}</span>}
  </div>
</a>
{canReserve && (
  <a class="reserve-btn" href={reserveHref}>ðŸ›’ Reserve for Pickup</a>
)}
{canBuy && (
  <button
    class="snipcart-add-item buy-btn"
    data-item-id={productId}
    data-item-name={name}
    data-item-price={numericPrice}
    data-item-url={itemUrl}
    data-item-image={image || ''}
    data-item-description={`${brand ? brand + ' â€” ' : ''}from ${shopName || shopSlug}`}
    data-item-weight={weight}
    data-item-custom1-name="Shop"
    data-item-custom1-value={shopName || shopSlug}
    data-item-custom2-name="Transaction Fee (8%)"
    data-item-custom2-value={`$${transactionFee}`}
    data-item-metadata={JSON.stringify({ shopSlug, transactionFee })}
  >
    ðŸ’³ Buy &amp; Ship
  </button>
)}

<style>
  .product-card {
    display: block;
    background: var(--surface-card);
    border: 2px solid var(--color-gray-700);
    overflow: hidden;
    transition: all var(--transition-fast);
    text-decoration: none;
    color: var(--text-primary);
    box-shadow: var(--shadow-sm);
  }
  .product-card:hover {
    border-color: var(--color-grip-yellow);
    transform: translate(1px, 1px);
    box-shadow: none;
  }
  .product-card--sold-out { opacity: 0.6; }
  .product-card--reserved { opacity: 0.8; }

  .product-card__image {
    position: relative;
    aspect-ratio: 1;
    background: var(--color-gray-800);
    overflow: hidden;
  }
  .product-card__image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  .product-card__placeholder {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    font-size: 2.5rem;
    opacity: 0.4;
  }
  .product-card__badge {
    position: absolute;
    top: var(--space-2, 8px);
    right: var(--space-2, 8px);
    background: var(--color-gray-900, #111);
    color: var(--text-primary, #fff);
    font-size: var(--text-xs, 0.75rem);
    font-family: var(--font-display, monospace);
    padding: var(--space-1, 4px) var(--space-2, 8px);
    text-transform: uppercase;
    font-weight: 700;
  }
  .product-card__badge--reserved {
    background: var(--color-grip-yellow, #f0c040);
    color: #111;
  }
  .product-card__body {
    padding: var(--space-3, 12px);
  }
  .product-card__brand {
    font-size: var(--text-xs, 0.75rem);
    color: var(--text-muted, #999);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }
  .product-card__name {
    margin: var(--space-1, 4px) 0;
    font-size: var(--text-md, 1rem);
    font-family: var(--font-display, monospace);
    line-height: 1.3;
  }
  .product-card__price {
    font-weight: 700;
    color: var(--color-grip-yellow, #f0c040);
  }
  .product-card__cat {
    display: block;
    font-size: var(--text-xs, 0.75rem);
    color: var(--text-muted, #999);
    text-transform: capitalize;
    margin-top: var(--space-1, 4px);
  }

  .reserve-btn {
    display: block;
    text-align: center;
    padding: var(--space-2, 8px) var(--space-3, 12px);
    background: var(--color-grip-yellow, #f0c040);
    color: #111;
    font-family: var(--font-display, monospace);
    font-weight: 700;
    font-size: var(--text-sm, 0.875rem);
    text-decoration: none;
    text-transform: uppercase;
    border: 2px solid var(--color-grip-yellow, #f0c040);
    transition: all 0.15s ease;
    margin-top: 2px;
  }
  .reserve-btn:hover {
    background: transparent;
    color: var(--color-grip-yellow, #f0c040);
  }

  .buy-btn {
    display: block;
    width: 100%;
    text-align: center;
    padding: var(--space-2, 8px) var(--space-3, 12px);
    background: var(--color-gray-100, #f5f5f5);
    color: #111;
    font-family: var(--font-display, monospace);
    font-weight: 700;
    font-size: var(--text-sm, 0.875rem);
    text-decoration: none;
    text-transform: uppercase;
    border: 2px solid var(--color-gray-300, #ccc);
    cursor: pointer;
    transition: all 0.15s ease;
    margin-top: 2px;
  }
  .buy-btn:hover {
    background: var(--color-grip-yellow, #f0c040);
    border-color: var(--color-grip-yellow, #f0c040);
    color: #111;
  }
</style>
